<h2 class="section clearfix" style="margin-bottom: 30px">
  <div style="float: left">
    eSeminarapparate verwalten &raquo; Details
  </div>

  <div class="align-right" style="margin-bottom: 5px">
    <% link_to admin_sem_apps_path, :class => 'pui-button' do %>
      <%= image_tag 'icons/arrow-curve-180-left.png', :plugin => 'pui' %>
      Zurück zur Übersicht
    <% end %>

    <% link_to edit_admin_sem_app_path(@sem_app), :class => "pui-button" do %>
      <%= image_tag 'icons/wrench-screwdriver.png', :plugin => 'pui' %>
      Bearbeiten
    <% end %>
  </div>
</h2>

<% if @sem_app.has_book_jobs? %>
  <div class="pui-panel notice align-center">
    <%= image_tag 'icons/star.png', :plugin => 'pui' %>
    Es gibt Buchaufträge für diesen Seminarapparat
    <a href="#" class="print pui-button">
      <%= image_tag 'icons/printer.png', :plugin => 'pui' %>
      Übersicht Drucken
    </a>
  </div>
<% end %>

<div class="pui-view clearfix">
  <div class="grid_8 alpha">
    <% unless @sem_app.approved %>
      <div class="pui-panel notice align-center">
        Der eSeminarapparat muss noch überprüft und freigeschaltet werden!
      </div>
    <% end %>

    <div class="pui-collection-view labeled">
      <%= labeled_item :label => 'Titel',       :content => link_to(h(@sem_app.title), sem_app_path(@sem_app)) %>
      <%= labeled_item :label => 'Tutor(en)',   :content => h(@sem_app.tutors) %>
      <%= labeled_item :label => 'Semester',    :content => h(@sem_app.semester.title) %>
      <%= labeled_item :label => 'Standort',    :content => h(@sem_app.location.title) %>
      <%= labeled_item :label => 'Lesekennung', :content => "<code>#{@sem_app.shared_secret}</code>" %>
    </div>
  </div>

  <div class="grid_4 omega">
    <div class="pui-panel">
      <h5 class="section">Ausweis / Regal</h5>
      <% if @sem_app.book_shelf.present? %>
        <p>
          <strong>Ausweis Nr.:</strong>
          <%= @sem_app.book_shelf.ils_account %>
        </p>
        <p>
          <strong>Regal Nr.:</strong>
          <%= @sem_app.book_shelf.slot_number %>
        </p>
      <% else %>
        <div class="pui-panel notice align-center">
          Dem Apparat wurde noch kein Regal/Ausweis zugeordnet
        </div>
      <% end %>
      <div style="font-size: 90%; text-align: center">
        <%= h(@sem_app.location.title) %>
      </div>
    </div>
  </div>
</div>


<div class="pui-tabs-wrapper">
  <ul class="pui-tabs">
    <li>
      <a href="#users">
        <%= image_tag 'icons/users.png', :plugin => 'pui' %>
        Besitzer / Benutzer
      </a>
    </li>
    <li>
      <a href="#new-books">
        <% if @new_books.present? %>
          <%= image_tag 'icons/overlay/book--plus.png', :plugin => 'pui' %>
        <% end %>
        Bücher einstellen
      </a>
    </li>
    <li>
      <a href="#remove-books">
        <% if @remove_books.present? %>
          <%= image_tag 'icons/overlay/book--minus.png', :plugin => 'pui' %>
        <% end %>
        Bücher entfernen
      </a>
    </li>
  </ul>

  <div class="pui-tab-panes">
    <div>
      <%= render 'users' %>
    </div>

    <div>
      <%= render 'books_to_add' %>
    </div>

    <div>
      <%= render 'books_to_remove' %>
    </div>
  </div>
</div>

<iframe 
  id="print-frame"
  name="print-frame"
  src="<%= admin_sem_app_path(@sem_app, :format => :print) -%>"
  style="width:0; height:0; position:absolute; left:-9999px;">
</iframe>

<script type="text/javascript">
  (function($) {
    $(function() {

      $(".print").live('click', function(e) {
        e.preventDefault();

        var frame = $("#print-frame");
        if (frame != null) {
          window.frames["print-frame"].focus();
          window.frames["print-frame"].print();
        }
      });
    
    });
  })(jQuery);
</script>