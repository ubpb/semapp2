<% semantic_form_for entry, :url => form_url_for_entry(entry), :html => {:class => "ajax-form", :multipart => true} do |f| %>
  <%= hidden_field_tag :class, 'SemAppFileEntry' %>
  <%= hidden_field_tag :origin_id, @origin_id %>

  <div style="height: 330px; overflow: auto">
    <% f.inputs :name => 'Eintrag' do %>
      <%= f.input :description, :label => 'Beschreibung', :input_html => {:rows => 3} %>
      <%= f.input :publish_on,  :label => 'VerÃ¶ffentlichen am', :required => false %>
    <% end %>

    <% f.inputs :name => 'Datei(en)', :id => 'attachment-listing' do %>
      <% if entry.new_record? and entry.attachments.blank? %>
        <% f.semantic_fields_for :attachments, Attachment.new do |a| %>
          <%= render 'attachment', :form => a %>
        <% end %>
      <% else %>
        <% f.semantic_fields_for :attachments do |a| %>
          <%= render 'attachment', :form => a %>
        <% end %>
      <% end %>
    <% end %>

    <div style="padding: 0 0 15px 0">
      <a id="add-attachment-action" href="#" class="pui-button">Eine (weitere) Datei hochladen</a>
    </div>
    <div id="new-attachment" class="hidden">
      <% f.semantic_fields_for :attachments, Attachment.new, :child_index => 'NEW_RECORD' do |a| %>
        <%= render 'attachment', :form => a %>
      <% end %>
    </div>
  </div>

  <% f.buttons do %>
    <%= f.commit_button 'Speichern' %>
  <% end %>
<% end %>

<script type="text/javascript">
  (function($) {

    $(function() {

      $("#add-attachment-action").click(function(e) {
        e.preventDefault();
        var record = $("#new-attachment").html();
        record = record.replace(/NEW_RECORD/g, new Date().getTime());
        $("#attachment-listing ol").append(record);
      });

    });

  })(jQuery);
</script>